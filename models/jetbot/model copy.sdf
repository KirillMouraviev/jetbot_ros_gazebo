


<?xml version="1.0" ?>
<sdf version="1.9">
  <model name="diffbot">
    <pose>0 0 0 0 0 0</pose>
    <static>false</static>

    <!-- Virtual frame equivalent of URDF base_footprint.
         URDF had base_link relative to base_footprint with RPY = (-1.5708, 0, 0), XYZ = (0, 0, 0.035).
         The inverse (frame relative to base_link) is RPY = (1.5708, 0, 0), XYZ = (0, 0.035, 0). -->
    <frame name="base_footprint" attached_to="base_link">
      <pose>0 0.035 0 1.5708 0 0</pose>
    </frame>

    <!-- base_link -->
    <link name="base_link">
      <pose relative_to="__model__">0 0 0 0 0 0</pose>
      <inertial>
        <pose>-0.025609 0.0093176 0.034957 0 0 0</pose>
        <mass>2</mass>
        <inertia>
          <ixx>0.0016616</ixx>
          <ixy>-5.2805e-05</ixy>
          <ixz>-3.0797e-06</ixz>
          <iyy>0.0024755</iyy>
          <iyz>-1.1469e-06</iyz>
          <izz>0.0030448</izz>
        </inertia>
      </inertial>
      <visual name="base_link_visual">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/base_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0 1 0 1</ambient>
          <diffuse>0 1 0 1</diffuse>
        </material>
      </visual>
      <collision name="base_link_collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/base_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
    </link>

    <!-- caster_ball_link -->
    <link name="caster_ball_link">
      <pose relative_to="base_link">-0.083 0.0208 0 -1.5708 0 3.1416</pose>
      <inertial>
        <pose>-1.8666e-06 -8.4152e-07 -0.0059479 0 0 0</pose>
        <mass>0.011917</mass>
        <inertia>
          <ixx>2.5586e-07</ixx>
          <ixy>6.7546e-11</ixy>
          <ixz>3.0679e-11</ixz>
          <iyy>1.8138e-07</iyy>
          <iyz>1.7478e-14</iyz>
          <izz>2.6388e-07</izz>
        </inertia>
      </inertial>
      <visual name="caster_ball_visual">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/caster_ball_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.61176 0.65882 0.67059 1</ambient>
          <diffuse>0.61176 0.65882 0.67059 1</diffuse>
        </material>
      </visual>
      <collision name="caster_ball_collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/caster_ball_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
    </link>

    <!-- camera_link -->
    <link name="camera_link">
      <pose relative_to="base_link">0.053557 -0.057568 0 1.9199 -1.5708 3.1416</pose>
      <inertial>
        <pose>7.2979e-05 -0.0036847 -0.0021354 0 0 0</pose>
        <mass>0.068956</mass>
        <inertia>
          <ixx>2.4451e-06</ixx>
          <ixy>1.5517e-12</ixy>
          <ixz>-1.8066e-08</ixz>
          <iyy>3.8509e-06</iyy>
          <iyz>1.5741e-11</iyz>
          <izz>2.7785e-06</izz>
        </inertia>
      </inertial>
      <visual name="camera_visual">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/camera_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0 0 0 1</ambient>
          <diffuse>0 0 0 1</diffuse>
        </material>
      </visual>
      <collision name="camera_collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/camera_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
     <sensor name="rgb_camera" type="camera">
        <always_on>true</always_on>
        <update_rate>30</update_rate>
        <visualize>true</visualize>
        <pose>0 0 0 0 0 0</pose>
        <camera>
          <horizontal_fov>1.3962634</horizontal_fov>   <!-- ~80deg -->
          <image>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </image>
          <clip>
            <near>0.05</near>
            <far>50.0</far>
          </clip>
        </camera>

        <!-- Bridge to ROS 2 -->
        <plugin name="gazebo_ros_camera" filename="libgazebo_ros_camera.so">
          <ros>
            <!-- <namespace>/jetbot</namespace> -->
            <remapping>image:=/camera/image_raw</remapping>
            <remapping>camera_info:=/camera/camera_info</remapping>
          </ros>
          <frame_name>camera_link</frame_name>
        </plugin>
      </sensor>
    </link>

    <!-- lidar_link -->
    <link name="lidar_link">
      <!-- URDF raised frame by +0.045 in z and shifted mesh down by 0.045 -->
      <pose relative_to="base_link">-0.011026 -0.1512 0 1.5708 0 0</pose>
      <inertial>
        <pose>-0.0065398705841951 0.000690713934940602 0.0309531855778308 0 0 0</pose>
        <mass>0.564294014597891</mass>
        <inertia>
          <ixx>0.000142259766419758</ixx>
          <ixy>-2.48879198210457e-06</ixy>
          <ixz>2.55066150802879e-06</ixz>
          <iyy>0.000186813526823412</iyy>
          <iyz>8.53957008589798e-08</iyz>
          <izz>0.000308569075147343</izz>
        </inertia>
      </inertial>
      <visual name="lidar_visual">
        <pose>0 0 -0.045 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/lidar_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0 0 0  1</ambient>
          <diffuse>0 0 0 1</diffuse>
        </material>
      </visual>
      <collision name="lidar_collision">
        <pose>0 0 -0.045 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/lidar_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
    <sensor name="scan" type="ray">
        <always_on>true</always_on>
        <update_rate>15</update_rate>
        <pose>0 0 0 0 0 0</pose>

        <ray>
          <scan>
            <horizontal>
              <samples>720</samples>
              <resolution>1</resolution>
              <min_angle>-1.5707963</min_angle>  <!-- -90deg -->
              <max_angle> 1.5707963</max_angle>  <!-- +90deg -->
            </horizontal>
          </scan>
          <range>
            <min>0.12</min>
            <max>10.0</max>
            <resolution>0.01</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.01</stddev>
          </noise>
        </ray>

        <!-- Bridge to ROS 2 -->
        <plugin name="gazebo_ros_ray_sensor" filename="libgazebo_ros_ray_sensor.so">
          <ros>
            <!-- <namespace>/jetbot</namespace> -->
            <remapping>scan:=/scan</remapping>
          </ros>
          <frame_name>lidar_link</frame_name>
          <!-- Optional: default 'laser' => you can change to 'infrared' or others -->
          <radiation>laser</radiation>
        </plugin>
      </sensor>
    </link>

    <!-- left_wheel_link -->
    <link name="left_wheel_link">
      <pose relative_to="base_link">0 0 0.0575 1.5708 0 0</pose>
      <inertial>
        <pose>-3.04495944265183e-05 0.0183179040454366 -1.07396547774597e-07 0 0 0</pose>
        <mass>0.388137366198046</mass>
        <inertia>
          <ixx>0.000163568162825962</ixx>
          <ixy>-1.71522947947033e-07</ixy>
          <ixz>-2.55253489205791e-08</ixz>
          <iyy>0.000281670214792073</iyy>
          <iyz>-1.06397401901507e-09</iyz>
          <izz>0.000163656330155147</izz>
        </inertia>
      </inertial>
      <visual name="left_wheel_visual">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/left_wheel_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0 0 0 1</ambient>
          <diffuse>0 0 0 1</diffuse>
        </material>
      </visual>
      <collision name="left_wheel_collision">
        <pose>0 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/left_wheel_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
    </link>

    <!-- right_wheel_link -->
    <link name="right_wheel_link">
      <pose relative_to="base_link">0 0 -0.0575 -1.5708 3.14359 3.14359</pose>
      <inertial>
        <pose>-3.04495944265183e-05 0.0183179040454366 -1.07396547774597e-07 0 0 0</pose>
        <mass>0.388137366198046</mass>
        <inertia>
          <ixx>0.000163568162825962</ixx>
          <ixy>-1.71522947947033e-07</ixy>
          <ixz>-2.55253489205791e-08</ixz>
          <iyy>0.000281670214792073</iyy>
          <iyz>-1.06397401901507e-09</iyz>
          <izz>0.000163656330155147</izz>
        </inertia>
      </inertial>
      <visual name="right_wheel_visual">
        <pose>0 0 0 0 0 3.14359</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/right_wheel_link.STL</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0 0 0 1</ambient>
          <diffuse>0 0 0 1</diffuse>
        </material>
      </visual>
      <collision name="right_wheel_collision">
        <pose>0 0 0 0 0 3.14359</pose>
        <geometry>
          <mesh>
            <uri>/home/panzer/wswsws/src/jetbot_description/model/meshes/right_wheel_link.STL</uri>
          </mesh>
        </geometry>
      </collision>
    </link>

    <!-- Joints -->

    <!-- caster fixed -->
    <joint name="caster_ball_fix_joint" type="fixed">
      <parent>base_link</parent>
      <child>caster_ball_link</child>
    </joint>

    <!-- camera fixed -->
    <joint name="camera_fix_joint" type="fixed">
      <parent>base_link</parent>
      <child>camera_link</child>
    </joint>

    <!-- lidar fixed -->
    <joint name="lidar_fix_joint" type="fixed">
      <parent>base_link</parent>
      <child>lidar_link</child>
    </joint>

    <!-- wheels continuous -->
    <joint name="left_wheel_continuous_joint" type="revolute">
      <parent>base_link</parent>
      <child>left_wheel_link</child>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <effort>9.6</effort>
        </limit>
        <dynamics>
          <damping>3.0</damping>
          <friction>0.5</friction>
        </dynamics>
      </axis>

    </joint>

    <joint name="right_wheel_continuous_joint" type="revolute">
      <parent>base_link</parent>
      <child>right_wheel_link</child>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <effort>9.6</effort>
        </limit>
        <dynamics>
          <damping>3.0</damping>
          <friction>0.5</friction>
        </dynamics>
      </axis>
    </joint>




    1) Joint states => robot_state_publisher => TF tree
    <plugin name="gazebo_ros_joint_state_publisher"
            filename="libgazebo_ros_joint_state_publisher.so">
      <ros>
        <!-- optional: put your namespace here -->
        <!-- <namespace>/jetbot</namespace> -->
      </ros>
      <!-- topic name to publish joint states -->
      <publish_topic>/joint_states</publish_topic>
      <!-- publish rate in Hz -->
      <update_rate>50</update_rate>
    </plugin>

    <!-- 2) Differential drive: listens /cmd_vel, publishes /odom and TF -->
    <plugin name="gazebo_ros_diff_drive" filename="libgazebo_ros_diff_drive.so">
      <ros>
        <!-- <namespace>/jetbot</namespace> -->
        <remapping>cmd_vel:=/cmd_vel</remapping>
        <remapping>odom:=/odom</remapping>
      </ros>

      <!-- Required joint names (match your SDF) -->
      <left_joint>left_wheel_continuous_joint</left_joint>
      <right_joint>right_wheel_continuous_joint</right_joint>

      <!-- Kinematic params (tune as needed) -->
      <wheel_separation>0.115</wheel_separation>   <!-- approx distance between wheel centers -->
      <wheel_radius>0.033</wheel_radius>           <!-- approx wheel radius -->

      <!-- I/O and frames -->
      <publish_tf>true</publish_tf>                 <!-- publish odom->base TF -->
      <tf_frame>base_link</tf_frame>                <!-- base frame -->
      <tf_odom_frame>odom</tf_odom_frame>          <!-- odom frame -->
      <publish_odom>true</publish_odom>            <!-- nav_msgs/Odometry -->
      <odometry_source>world</odometry_source>     <!-- 'encoder' or 'world' -->

      <!-- Limits / behavior -->
      <update_rate>50</update_rate>
      <cmd_vel_timeout>0.5</cmd_vel_timeout>
      <max_wheel_torque>2.0</max_wheel_torque>
      <max_wheel_acceleration>5.0</max_wheel_acceleration>
    </plugin>



    <!-- 4) LIDAR SENSOR on lidar_link -->
    <!-- Keep the rest of your links/joints (base_link, wheels, etc.) exactly as you already have them -->
    <!-- ... your base_link, caster, wheels, joints ... -->


  </model>
</sdf>
